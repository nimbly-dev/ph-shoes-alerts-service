spring:
  application:
    name: ph-shoes-alerts-service-scheduler-web
  main:
    web-application-type: servlet
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:snowflake://${SNOWFLAKE_ACCOUNT}.snowflakecomputing.com/?warehouse=${SNOWFLAKE_WAREHOUSE}&db=${SNOWFLAKE_DATABASE}&schema=${SNOWFLAKE_SCHEMA:PRODUCTION_MARTS}&role=${SNOWFLAKE_ROLE:}&JDBC_QUERY_RESULT_FORMAT=JSON}
    username: ${SNOWFLAKE_USER:${SPRING_DATASOURCE_USERNAME}}
    password: ${SNOWFLAKE_PWD:${SPRING_DATASOURCE_PASSWORD}}
    driver-class-name: net.snowflake.client.jdbc.SnowflakeDriver
    hikari:
      data-source-properties:
        ENABLE_ARROW_RESULTSET: false
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      adjust-dates-to-context-time-zone: false

springdoc:
  swagger-ui:
    path: /api/v1/swagger-ui.html
  api-docs:
    path: /api/v1/api-docs

logging:
  level:
    root: INFO
    com.nimbly.phshoesbackend.alerts.scheduler: INFO
server:
  port: ${PORT:8085}

aws:
  region: ${AWS_REGION:ap-southeast-1}
  endpoint: ${AWS_ENDPOINT:}

notification:
  provider: ${NOTIFICATION_PROVIDER:smtp}
  transport: ${NOTIFICATION_TRANSPORT:${NOTIFICATION_PROVIDER:smtp}}
  email:
    from: ${NOTIFICATION_FROM:PH Shoes <alerts@phshoesproject.com>}
    list-unsubscribe: ${NOTIFICATION_LIST_UNSUBSCRIBE:<mailto:unsubscribe@phshoesproject.com>, <https://www.phshoesproject.com/account/alerts>}
    list-unsubscribe-post: ${NOTIFICATION_LIST_UNSUBSCRIBE_POST:List-Unsubscribe=One-Click}
    subject-prefix: "[PH Shoes]"
    unsubscribe-link: ${NOTIFICATION_UNSUBSCRIBE_LINK:http://localhost:8082/api/v1/user-accounts/unsubscribe}
  smtp:
    host: ${NOTIFICATION_SMTP_HOST:mailhog}
    port: ${NOTIFICATION_SMTP_PORT:1025}
    auth: false
    starttls: false
    connection-timeout-millis: 5000
    read-timeout-millis: 5000
    write-timeout-millis: 5000

schema:
  migrations:
    enabled: false

alerts:
  scheduler:
    enabled: true
    cron: "0 30 23 * * *"
    zone: "Asia/Manila"
    run-on-startup: true
    dry-run: false
    max-alerts-per-product: 1000
    test-email: ${ALERTS_TEST_EMAIL:}
    fallback-to-latest-when-empty: true
    unsubscribe-mailto: ${ALERTS_UNSUBSCRIBE_MAILTO:mailto:unsubscribe@phshoesproject.com}
    unsubscribe-url: ${ALERTS_UNSUBSCRIBE_URL:${NOTIFICATION_UNSUBSCRIBE_LINK:http://localhost:8082/api/v1/user-accounts/unsubscribe}}

verification:
  secret: ${VERIFICATION_SECRET:change-me-for-dev}
  verification-link: ${VERIFICATION_LINK:http://localhost:8082/verify}
  unsubscribe-link: ${VERIFICATION_UNSUBSCRIBE_LINK:${NOTIFICATION_UNSUBSCRIBE_LINK:http://localhost:8082/api/v1/user-accounts/unsubscribe}}

phshoes:
  dynamo:
    migrations:
      enabled: true
  security:
    email:
      hmac-pepper-b64: ${HMAC_PEPPER_B64:FVl9pBApQ2LgzIvgi7P/zMcc6BKoopvS}
      aes-key-b64: ${AES_KEY_B64:8c2So7nkW7FInwpQfQYsk6NHg+9FJPxGSd701VXjSnQ=}
      legacy-peppers-b64: ${HMAC_LEGACY_PEPPERS_B64:}
    jwt:
      enabled: false
      secret: ${JWT_SECRET:change-me-for-dev}
  suppression:
    table-name: ${SUPPRESSIONS_TABLE:email_suppressions}
  status:
    enabled: true
    path: /api/v1/system/status
    service-id: alerts
    display-name: Alerts Service
    environment: ${APP_ENV:local}
    version: ${APP_VERSION:local}
    description: Handles price alert notifications and scheduling.
    metadata:
      tier: backend
